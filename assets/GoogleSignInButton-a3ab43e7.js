import{r as l,t as q,u as B,g as M,f as Y,j as _,a as D,b as h,Q as T}from"./index-d7ba1f3b.js";function H(e={}){const{nonce:n,onScriptLoadSuccess:r,onScriptLoadError:a}=e,[g,s]=l.useState(!1),t=l.useRef(r);t.current=r;const i=l.useRef(a);return i.current=a,l.useEffect(()=>{const c=document.createElement("script");return c.src="https://accounts.google.com/gsi/client",c.async=!0,c.defer=!0,c.nonce=n,c.onload=()=>{var o;s(!0),(o=t.current)===null||o===void 0||o.call(t)},c.onerror=()=>{var o;s(!1),(o=i.current)===null||o===void 0||o.call(i)},document.body.appendChild(c),()=>{document.body.removeChild(c)}},[n]),g}const F=l.createContext(null);function Q({clientId:e,nonce:n,onScriptLoadSuccess:r,onScriptLoadError:a,children:g}){const s=H({nonce:n,onScriptLoadSuccess:r,onScriptLoadError:a}),t=l.useMemo(()=>({clientId:e,scriptLoadedSuccessfully:s}),[e,s]);return q.createElement(F.Provider,{value:t},g)}function U(){const e=l.useContext(F);if(!e)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return e}function V(e){var n;return(n=e==null?void 0:e.clientId)!==null&&n!==void 0?n:e==null?void 0:e.client_id}const K={large:40,medium:32,small:20};function P({onSuccess:e,onError:n,useOneTap:r,promptMomentNotification:a,type:g="standard",theme:s="outline",size:t="large",text:i,shape:c,logo_alignment:o,width:S,locale:u,click_listener:v,containerProps:f,...w}){const A=l.useRef(null),{clientId:N,scriptLoadedSuccessfully:j}=U(),$=l.useRef(e);$.current=e;const I=l.useRef(n);I.current=n;const J=l.useRef(a);return J.current=a,l.useEffect(()=>{var k,x,y,L,b,E,C,G,O;if(j)return(y=(x=(k=window==null?void 0:window.google)===null||k===void 0?void 0:k.accounts)===null||x===void 0?void 0:x.id)===null||y===void 0||y.initialize({client_id:N,callback:d=>{var m;if(!(d!=null&&d.credential))return(m=I.current)===null||m===void 0?void 0:m.call(I);const{credential:p,select_by:R}=d;$.current({credential:p,clientId:V(d),select_by:R})},...w}),(E=(b=(L=window==null?void 0:window.google)===null||L===void 0?void 0:L.accounts)===null||b===void 0?void 0:b.id)===null||E===void 0||E.renderButton(A.current,{type:g,theme:s,size:t,text:i,shape:c,logo_alignment:o,width:S,locale:u,click_listener:v}),r&&((O=(G=(C=window==null?void 0:window.google)===null||C===void 0?void 0:C.accounts)===null||G===void 0?void 0:G.id)===null||O===void 0||O.prompt(J.current)),()=>{var d,m,p;r&&((p=(m=(d=window==null?void 0:window.google)===null||d===void 0?void 0:d.accounts)===null||m===void 0?void 0:m.id)===null||p===void 0||p.cancel())}},[N,j,r,g,s,t,i,c,o,S,u]),q.createElement("div",{...f,ref:A,style:{height:K[t],...f==null?void 0:f.style}})}const X=({role:e})=>{const{i18n:n}=B(),r=M(),{mainRequest:a}=l.useContext(Y);JSON.parse(localStorage.getItem("userToken")),JSON.parse(localStorage.getItem("sellerToken"));const g=async t=>{try{if(console.log("Login Successful:",t),t.credential&&t.clientId){const{credential:i,clientId:c}=t,o=JSON.parse(atob(i.split(".")[1])),S={first_name:o.given_name,last_name:o.family_name,email:o.email,provider_id:o.sub};if(e==="user"){const u=await D.post(`${h}/user/socialite`,S);T.success(n.language==="en"?"You are logged in successfully":"تم تسجيل الدخول بنجاح");const v=u.data.user;v.token=u.data.access_token,localStorage.clear(),localStorage.setItem("userToken",JSON.stringify(v.token)),localStorage.setItem("userLogged",!0),localStorage.setItem("providerId",u.data.user.provider_id);const f=await a(`${h}/auth/user-profile?token=${v.token}`),{data:w}=f;r("/profile"),w.phone||(localStorage.setItem("complete",!1),localStorage.setItem("role","user"),location.href="/")}if(e==="seller"){const u=await D.post(`${h}/vendor/socialite`,S);T.success(n.language==="en"?"You are logged in successfully":"تم تسجيل الدخول بنجاح");const v=u.data;v.token=u.data.access_token,localStorage.clear(),localStorage.setItem("sellerToken",JSON.stringify(u.data.access_token)),localStorage.setItem("sellerLogged",!0),localStorage.setItem("providerId",o.sub);const f=await a(`${h}/vendor/auth/user-profile?token=${v.token}`),{data:w}=f;r("/dashboard"),w.phone||(localStorage.setItem("complete",!1),localStorage.setItem("role","seller"),location.href="/")}}else console.log("Login data structure is not as expected:",t)}catch(i){console.error("An error occurred:",i)}},s=()=>{console.log("Login Failed")};return _.jsx(_.Fragment,{children:_.jsx(Q,{clientId:"289535605481-6vot6d8uosg3aakd7utugpe3vemh5gv1.apps.googleusercontent.com",children:_.jsx(P,{className:"bg-red-500",onSuccess:g,onError:s,auto_select:!0})})})};export{X as G};
