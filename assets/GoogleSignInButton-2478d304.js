import{r as c,R as N,u as J,d as M,j as O,a as R,b as H,Q as P}from"./index-d1014b71.js";function Q(o={}){const{nonce:n,onScriptLoadSuccess:i,onScriptLoadError:u}=o,[s,t]=c.useState(!1),r=c.useRef(i);r.current=i;const v=c.useRef(u);return v.current=u,c.useEffect(()=>{const e=document.createElement("script");return e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.nonce=n,e.onload=()=>{var l;t(!0),(l=r.current)===null||l===void 0||l.call(r)},e.onerror=()=>{var l;t(!1),(l=v.current)===null||l===void 0||l.call(v)},document.body.appendChild(e),()=>{document.body.removeChild(e)}},[n]),s}const D=c.createContext(null);function T({clientId:o,nonce:n,onScriptLoadSuccess:i,onScriptLoadError:u,children:s}){const t=Q({nonce:n,onScriptLoadSuccess:i,onScriptLoadError:u}),r=c.useMemo(()=>({clientId:o,scriptLoadedSuccessfully:t}),[o,t]);return N.createElement(D.Provider,{value:r},s)}function V(){const o=c.useContext(D);if(!o)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return o}function Y(o){var n;return(n=o==null?void 0:o.clientId)!==null&&n!==void 0?n:o==null?void 0:o.client_id}const $={large:40,medium:32,small:20};function q({onSuccess:o,onError:n,useOneTap:i,promptMomentNotification:u,type:s="standard",theme:t="outline",size:r="large",text:v,shape:e,logo_alignment:l,width:d,locale:f,click_listener:U,containerProps:w,...B}){const G=c.useRef(null),{clientId:C,scriptLoadedSuccessfully:k}=V(),j=c.useRef(o);j.current=o;const _=c.useRef(n);_.current=n;const A=c.useRef(u);return A.current=u,c.useEffect(()=>{var S,h,L,x,y,I,b,E,p;if(k)return(L=(h=(S=window==null?void 0:window.google)===null||S===void 0?void 0:S.accounts)===null||h===void 0?void 0:h.id)===null||L===void 0||L.initialize({client_id:C,callback:a=>{var g;if(!(a!=null&&a.credential))return(g=_.current)===null||g===void 0?void 0:g.call(_);const{credential:m,select_by:F}=a;j.current({credential:m,clientId:Y(a),select_by:F})},...B}),(I=(y=(x=window==null?void 0:window.google)===null||x===void 0?void 0:x.accounts)===null||y===void 0?void 0:y.id)===null||I===void 0||I.renderButton(G.current,{type:s,theme:t,size:r,text:v,shape:e,logo_alignment:l,width:d,locale:f,click_listener:U}),i&&((p=(E=(b=window==null?void 0:window.google)===null||b===void 0?void 0:b.accounts)===null||E===void 0?void 0:E.id)===null||p===void 0||p.prompt(A.current)),()=>{var a,g,m;i&&((m=(g=(a=window==null?void 0:window.google)===null||a===void 0?void 0:a.accounts)===null||g===void 0?void 0:g.id)===null||m===void 0||m.cancel())}},[C,k,i,s,t,r,v,e,l,d,f]),N.createElement("div",{...w,ref:G,style:{height:$[r],...w==null?void 0:w.style}})}const W=({role:o})=>{const{i18n:n}=J(),i=M(),u=t=>{if(console.log("Login Successful:",t),t.credential&&t.clientId){const{credential:r,clientId:v}=t,e=JSON.parse(atob(r.split(".")[1]));if(console.log("User Profile Data:",e),o==="user"){const l={first_name:e.given_name,last_name:e.family_name,email:e.email,provider_id:e.sub};R.post(`${H}/user/socialite`,l).then(d=>{console.log("User data sent successfully:",d.data),P.success(n.language==="en"?"You are logged in successfully":"تم تسجيل الدخول بنجاح");const f=d.data.user;f.token=d.data.access_token,localStorage.clear(),localStorage.setItem("userToken",JSON.stringify(f.token)),localStorage.setItem("userLogged",!0),localStorage.setItem("providerId",d.data.user.provider_id),i("/home")}).catch(d=>{console.error("Error sending user data:",d)})}}else console.log("Login data structure is not as expected:",t)},s=()=>{console.log("Login Failed")};return O.jsx(T,{clientId:"289535605481-6vot6d8uosg3aakd7utugpe3vemh5gv1.apps.googleusercontent.com",children:O.jsx(q,{className:"bg-red-500",onSuccess:u,onError:s,auto_select:!0})})};export{W as G};
