import{r,t as T,u as B,f as M,e as Y,j as _,a as R,b as h,Q as D}from"./index-dc3c069d.js";function H(e={}){const{nonce:t,onScriptLoadSuccess:l,onScriptLoadError:c}=e,[v,s]=r.useState(!1),n=r.useRef(l);n.current=l;const i=r.useRef(c);return i.current=c,r.useEffect(()=>{const a=document.createElement("script");return a.src="https://accounts.google.com/gsi/client",a.async=!0,a.defer=!0,a.nonce=t,a.onload=()=>{var o;s(!0),(o=n.current)===null||o===void 0||o.call(n)},a.onerror=()=>{var o;s(!1),(o=i.current)===null||o===void 0||o.call(i)},document.body.appendChild(a),()=>{document.body.removeChild(a)}},[t]),v}const q=r.createContext(null);function Q({clientId:e,nonce:t,onScriptLoadSuccess:l,onScriptLoadError:c,children:v}){const s=H({nonce:t,onScriptLoadSuccess:l,onScriptLoadError:c}),n=r.useMemo(()=>({clientId:e,scriptLoadedSuccessfully:s}),[e,s]);return T.createElement(q.Provider,{value:n},v)}function U(){const e=r.useContext(q);if(!e)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return e}function V(e){var t;return(t=e==null?void 0:e.clientId)!==null&&t!==void 0?t:e==null?void 0:e.client_id}const K={large:40,medium:32,small:20};function P({onSuccess:e,onError:t,useOneTap:l,promptMomentNotification:c,type:v="standard",theme:s="outline",size:n="large",text:i,shape:a,logo_alignment:o,width:S,locale:u,click_listener:g,containerProps:f,...w}){const A=r.useRef(null),{clientId:N,scriptLoadedSuccessfully:j}=U(),$=r.useRef(e);$.current=e;const I=r.useRef(t);I.current=t;const J=r.useRef(c);return J.current=c,r.useEffect(()=>{var k,y,x,b,L,E,C,G,O;if(j)return(x=(y=(k=window==null?void 0:window.google)===null||k===void 0?void 0:k.accounts)===null||y===void 0?void 0:y.id)===null||x===void 0||x.initialize({client_id:N,callback:d=>{var m;if(!(d!=null&&d.credential))return(m=I.current)===null||m===void 0?void 0:m.call(I);const{credential:p,select_by:F}=d;$.current({credential:p,clientId:V(d),select_by:F})},...w}),(E=(L=(b=window==null?void 0:window.google)===null||b===void 0?void 0:b.accounts)===null||L===void 0?void 0:L.id)===null||E===void 0||E.renderButton(A.current,{type:v,theme:s,size:n,text:i,shape:a,logo_alignment:o,width:S,locale:u,click_listener:g}),l&&((O=(G=(C=window==null?void 0:window.google)===null||C===void 0?void 0:C.accounts)===null||G===void 0?void 0:G.id)===null||O===void 0||O.prompt(J.current)),()=>{var d,m,p;l&&((p=(m=(d=window==null?void 0:window.google)===null||d===void 0?void 0:d.accounts)===null||m===void 0?void 0:m.id)===null||p===void 0||p.cancel())}},[N,j,l,v,s,n,i,a,o,S,u]),T.createElement("div",{...f,ref:A,style:{height:K[n],...f==null?void 0:f.style}})}const X=({role:e})=>{const{i18n:t}=B(),l=M(),{mainRequest:c}=r.useContext(Y);JSON.parse(localStorage.getItem("userToken")),JSON.parse(localStorage.getItem("sellerToken"));const v=async n=>{try{if(n.credential&&n.clientId){const{credential:i,clientId:a}=n,o=JSON.parse(atob(i.split(".")[1])),S={first_name:o.given_name,last_name:o.family_name,email:o.email,provider_id:o.sub};if(e==="user"){const u=await R.post(`${h}/user/socialite`,S);D.success(t.language==="en"?"You are logged in successfully":"تم تسجيل الدخول بنجاح");const g=u.data.user;g.token=u.data.access_token,localStorage.clear(),localStorage.setItem("userToken",JSON.stringify(g.token)),localStorage.setItem("userLogged",!0),localStorage.setItem("providerId",u.data.user.provider_id);const f=await c(`${h}/auth/user-profile?token=${g.token}`),{data:w}=f;l("/profile"),w.phone||(localStorage.setItem("complete",!1),localStorage.setItem("role","user"),location.href="/")}if(e==="seller"){const u=await R.post(`${h}/vendor/socialite`,S);D.success(t.language==="en"?"You are logged in successfully":"تم تسجيل الدخول بنجاح");const g=u.data;g.token=u.data.access_token,localStorage.clear(),localStorage.setItem("sellerToken",JSON.stringify(u.data.access_token)),localStorage.setItem("sellerLogged",!0),localStorage.setItem("providerId",o.sub);const f=await c(`${h}/vendor/auth/user-profile?token=${g.token}`),{data:w}=f;l("/dashboard"),w.phone||(localStorage.setItem("complete",!1),localStorage.setItem("role","seller"),location.href="/")}}}catch(i){console.error("An error occurred:",i)}},s=()=>{console.log("Login Failed")};return _.jsx(_.Fragment,{children:_.jsx(Q,{clientId:"289535605481-6vot6d8uosg3aakd7utugpe3vemh5gv1.apps.googleusercontent.com",children:_.jsx(P,{className:"bg-red-500",onSuccess:v,onError:s,auto_select:!0})})})};export{X as G};
