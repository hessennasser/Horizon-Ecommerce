import{r as i,R as D,u as U,f as Y,j as A,a as N,b as J,Q as B}from"./index-90b8ff94.js";function $(o={}){const{nonce:t,onScriptLoadSuccess:r,onScriptLoadError:a}=o,[s,n]=i.useState(!1),u=i.useRef(r);u.current=r;const v=i.useRef(a);return v.current=a,i.useEffect(()=>{const e=document.createElement("script");return e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.nonce=t,e.onload=()=>{var l;n(!0),(l=u.current)===null||l===void 0||l.call(u)},e.onerror=()=>{var l;n(!1),(l=v.current)===null||l===void 0||l.call(v)},document.body.appendChild(e),()=>{document.body.removeChild(e)}},[t]),s}const F=i.createContext(null);function H({clientId:o,nonce:t,onScriptLoadSuccess:r,onScriptLoadError:a,children:s}){const n=$({nonce:t,onScriptLoadSuccess:r,onScriptLoadError:a}),u=i.useMemo(()=>({clientId:o,scriptLoadedSuccessfully:n}),[o,n]);return D.createElement(F.Provider,{value:u},s)}function Q(){const o=i.useContext(F);if(!o)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return o}function V(o){var t;return(t=o==null?void 0:o.clientId)!==null&&t!==void 0?t:o==null?void 0:o.client_id}const q={large:40,medium:32,small:20};function K({onSuccess:o,onError:t,useOneTap:r,promptMomentNotification:a,type:s="standard",theme:n="outline",size:u="large",text:v,shape:e,logo_alignment:l,width:c,locale:f,click_listener:M,containerProps:S,...R}){const G=i.useRef(null),{clientId:k,scriptLoadedSuccessfully:C}=Q(),O=i.useRef(o);O.current=o;const _=i.useRef(t);_.current=t;const j=i.useRef(a);return j.current=a,i.useEffect(()=>{var w,h,I,y,L,b,x,E,p;if(C)return(I=(h=(w=window==null?void 0:window.google)===null||w===void 0?void 0:w.accounts)===null||h===void 0?void 0:h.id)===null||I===void 0||I.initialize({client_id:k,callback:d=>{var g;if(!(d!=null&&d.credential))return(g=_.current)===null||g===void 0?void 0:g.call(_);const{credential:m,select_by:T}=d;O.current({credential:m,clientId:V(d),select_by:T})},...R}),(b=(L=(y=window==null?void 0:window.google)===null||y===void 0?void 0:y.accounts)===null||L===void 0?void 0:L.id)===null||b===void 0||b.renderButton(G.current,{type:s,theme:n,size:u,text:v,shape:e,logo_alignment:l,width:c,locale:f,click_listener:M}),r&&((p=(E=(x=window==null?void 0:window.google)===null||x===void 0?void 0:x.accounts)===null||E===void 0?void 0:E.id)===null||p===void 0||p.prompt(j.current)),()=>{var d,g,m;r&&((m=(g=(d=window==null?void 0:window.google)===null||d===void 0?void 0:d.accounts)===null||g===void 0?void 0:g.id)===null||m===void 0||m.cancel())}},[k,C,r,s,n,u,v,e,l,c,f]),D.createElement("div",{...S,ref:G,style:{height:q[u],...S==null?void 0:S.style}})}const W=({role:o})=>{const{i18n:t}=U(),r=Y(),a=n=>{if(console.log("Login Successful:",n),n.credential&&n.clientId){const{credential:u,clientId:v}=n,e=JSON.parse(atob(u.split(".")[1])),l={first_name:e.given_name,last_name:e.family_name,email:e.email,provider_id:e.sub};o==="user"&&N.post(`${J}/user/socialite`,l).then(c=>{console.log("User data sent successfully:",c.data),B.success(t.language==="en"?"You are logged in successfully":"تم تسجيل الدخول بنجاح");const f=c.data.user;f.token=c.data.access_token,localStorage.clear(),localStorage.setItem("userToken",JSON.stringify(f.token)),localStorage.setItem("userLogged",!0),localStorage.setItem("providerId",c.data.user.provider_id),r("/home")}).catch(c=>{console.error("Error sending user data:",c)}),o==="seller"&&N.post(`${J}/vendor/socialite`,l).then(c=>{B.success(t.language==="en"?"You are logged in successfully":"تم تسجيل الدخول بنجاح"),localStorage.clear(),localStorage.setItem("sellerToken",JSON.stringify(c.data.access_token)),localStorage.setItem("sellerLogged",!0),localStorage.setItem("providerId",e.sub),r("/dashboard")}).catch(c=>{console.error("Error sending user data:",c)})}else console.log("Login data structure is not as expected:",n)},s=()=>{console.log("Login Failed")};return A.jsx(H,{clientId:"289535605481-6vot6d8uosg3aakd7utugpe3vemh5gv1.apps.googleusercontent.com",children:A.jsx(K,{className:"bg-red-500",onSuccess:a,onError:s,auto_select:!0})})};export{W as G};
