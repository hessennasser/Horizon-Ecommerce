import{r as o,A as E,u as z,j as e,F as D,v as P,b as k,Q as x}from"./index-4a77c58a.js";import{L as h,T as N,S as R}from"./Tooltip-96ae7d57.js";import{S as B}from"./react-select.esm-8bb2a168.js";import"./index.esm-b87068f3.js";import"./floating-ui.dom-9d44cd4e.js";import"./toConsumableArray-6566f3f4.js";import"./emotion-unitless.esm-475d8cc4.js";const U=({productId:m,productData:g,getProductData:u,setIsLoading:y,getSellerProducts:_,setAllProducts:w,setLoadingAllProducts:b})=>{const{mainRequest:j}=o.useContext(E),v=JSON.parse(localStorage.getItem("sellerToken")),[n,C]=o.useState(null),{i18n:d}=z(),S=async l=>{y(!0);try{const s=new FormData;s.append("token",v),s.append("product_id",m),s.append("image",l);const t=await j.post(`${k}/product/image/create`,s,{headers:{"Content-Type":"multipart/form-data"}});u(),x.success(d.language==="en"?"The product has been updated":"تم تعديل المنتج بنجاح")}catch{x.error(d.language==="en"?"There is an error, please try again later":"يوجد خطأ ما، الرجاء المحاولة مره اخري")}finally{y(!1),_(w,b)}},F=l=>{const s=l.target.files[0];s&&(C(s),S(s))},I=()=>{document.getElementById("image").click()},r=async l=>{y(!0);try{const s=await j.post(`${k}/product/image/delete`,{token:v,id:l});u(),x.success(d.language==="en"?"The product has been updated":"تم تعديل المنتج بنجاح")}catch{x.error(d.language==="en"?"There is an error, please try again later":"يوجد خطأ ما، الرجاء المحاولة مره اخري")}finally{y(!1),_(w,b)}};return e.jsx("div",{className:"space-y-6 grid grid-cols-2 grid-rows-2 gap-3 w-full",children:g&&g.images.length>0&&e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 justify-center",children:[g.images.map((l,s)=>e.jsxs("div",{className:"relative p-2 border-2 min-h-[228px] ",children:[e.jsx("img",{src:`https://admin.horriizon.com/public/${l.path}`,alt:`Image ${s}`,className:"object-contain"}),g.images.length>1&&e.jsx("button",{className:"absolute top-0 right-0 text-red-600 p-1 bg-white rounded-full hover:bg-red-100",onClick:()=>r(l.id),children:e.jsx(D,{})})]},s)),g.images.length<4&&e.jsxs("button",{className:" min-h-[228px] flex items-center justify-center rounded-md border-dotted border-2 border-secondColor hover:bg-gray-300",onClick:I,children:[e.jsx(P,{}),e.jsx("input",{type:"file",id:"image",accept:"image/*",hidden:!0,onChange:F})]})]})})})},L=({productId:m,editModal:g,setEditModal:u,setSelectedGovernorate:y,encategoriesOptions:_,arcategoriesOptions:w,getSellerProducts:b,setAllProducts:j,setIsLoading:v})=>{const{i18n:n}=z(),{mainRequest:C}=o.useContext(E),d=JSON.parse(localStorage.getItem("sellerToken")),[S,F]=o.useState(!1),I=()=>{F(!0)},[r,l]=o.useState(null),s=async()=>{try{const a=await C.post(`${k}/vendor/products/get`,{token:d,id:m}),{data:c}=a;l(c.data)}catch(a){console.log(a)}};o.useEffect(()=>{s()},[m]);const[t,p]=o.useState({image:null,title_en:"",title_ar:"",category:null,quantity:"",price:"",start_date:""});o.useEffect(()=>{r&&p({image:null,title_en:r.title.en,title_ar:r.title.ar,category:r.category,quantity:r.quantity,price:r.price,start_date:r.start_date})},[r,m]);const[q,f]=o.useState(!1),$=async(a,c,i)=>{f(!0);try{const T=await C.post(`${k}/vendor/products/${i}/update`,a,{headers:{accept:"application/json","Content-Type":"multipart/form-data",Authorization:`Bearer ${d}`}});console.log(T.data),x.success(n.language==="en"?"The product has been updated":"تم تعديل المنتج بنجاح")}catch(T){console.log(T),x.error(n.language==="en"?"There is an error, please try again later":"يوجد خطأ ما، الرجاء المحاولة مره اخري")}finally{f(!1),c(!1),b(j,v)}},M=()=>{if(selectedImage){const a=new FileReader;a.onloadend=()=>{const c=new Blob([a.result],{type:selectedImage.type}),i=new FormData;i.append("images",c),i.append("title_en",t.title_en),i.append("title_ar",t.title_ar),i.append("category_id",t.category.value||r.category.id),i.append("quantity",t.quantity),i.append("price",t.price),i.append("start_date",t.start_date),$(i,c,f)},a.readAsArrayBuffer(selectedImage)}else{const a=new FormData;a.append("title_en",t.title_en),a.append("title_ar",t.title_ar),a.append("category_id",t.category.value||r.category.id),a.append("quantity",t.quantity),a.append("price",t.price),a.append("start_date",t.start_date),a.append("images",t.image),$(a,f,u)}};return e.jsx("div",{className:"fixed z-[10000] inset-0 overflow-y-auto",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen px-4 pt-4 pb-20 sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-90"})}),e.jsxs("div",{className:"modal-app relative bg-white rounded-lg overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsxs("div",{className:"sticky z-10 top-0 left-0 right-0 bg-white px-4 py-2 shadow-md flex justify-between",children:[e.jsx("h3",{className:"text-xl font-medium text-secondColor",children:n.language==="en"?"Edit Product":"تعديل المنتج"}),e.jsx("button",{className:"border border-secondColor text-secondColor py-1 px-4 rounded-md hover:brightness-110",onClick:()=>{u(!1)},children:e.jsx(D,{})})]}),e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 flex items-center justify-center flex-1",children:S?e.jsx(U,{productId:m,productData:r,getProductData:s,setIsLoading:f,getSellerProducts:b,setAllProducts:j,setLoadingAllProducts:v}):e.jsxs("div",{className:"space-y-6 grid grid-cols-2 gap-3 w-full",children:[e.jsxs("div",{className:"col-span-2",children:[r&&r.images.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:r.images.map((a,c)=>e.jsx("img",{src:`https://admin.horriizon.com/public/${a.path}`,alt:`Image ${c}`,className:"h-20 w-20 object-contain"}))}),e.jsx("div",{className:"mb-2 block"}),e.jsx("button",{type:"button",className:"flex items-center justify-center gap-2 w-full bg-green-500 duration-200 py-1 px-4 rounded-md hover:brightness-110 text-white",onClick:()=>{I()},children:n.language==="en"?"Edit Images":"تعديل الصور "})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(h,{htmlFor:"title_en",value:n.language==="en"?"Product Name English ":"اسم المنتج بالانجليزية "})}),e.jsx(N,{id:"title_en",type:"text",value:t.title_en,onChange:a=>p({...t,title_en:a.target.value})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(h,{htmlFor:"title_ar",value:n.language==="en"?"Product Name Arabic ":"اسم المنتج بالعربية "})}),e.jsx(N,{id:"title_ar",type:"text",value:t.title_ar,onChange:a=>p({...t,title_ar:a.target.value})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(h,{htmlFor:"category",value:n.language==="en"?"Product Category ":"تصنيف المنتج "})}),e.jsx(B,{name:"category",id:"category",className:"w-full",options:n.language==="en"?_:w,placeholder:n.language==="en"?"Product Category":"تصنيف المنتج",isRtl:n.language==="ar",isSearchable:!0,value:t.category,onChange:a=>p({...t,category:a})})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(h,{htmlFor:"quantity",value:n.language==="en"?"Quantity ":" الكمية"})}),e.jsx(N,{id:"quantity",type:"number",min:1,value:t.quantity,onChange:a=>p({...t,quantity:a.target.value})})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(h,{htmlFor:"Price",value:n.language==="en"?"Price ":" السعر"})}),e.jsx(N,{id:"Price",type:"number",min:1,value:t.price,onChange:a=>p({...t,price:a.target.value})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(h,{htmlFor:"expiry-date",value:n.language==="en"?"Expiry date ":"تاريخ الانتهاء "})}),e.jsx(N,{id:"expiry-date",type:"date",value:t.start_date,onChange:a=>p({...t,start_date:a.target.value})})]})]})}),e.jsxs("div",{className:" sticky z-10 bottom-0 left-0 right-0 bg-gray-50 px-4 py-3 shadow-md flex items-center gap-2",children:[e.jsx("button",{className:"bg-secondColor py-1 px-4 rounded-md hover:brightness-110 text-white mx-2",onClick:M,disabled:q,children:q?e.jsx(R,{"aria-label":"loading...",color:"purple"}):n.language==="en"?"Save":"حفظ"}),e.jsx("button",{className:"border border-secondColor text-secondColor py-1 px-4 rounded-md hover:brightness-110",onClick:()=>{u(!1)},children:n.language==="en"?"Cancel":"الغاء"})]})]})]})})};export{L as default};
